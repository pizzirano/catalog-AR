<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <title>Robot AR - L&L Tecnologias LTDA</title>

    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/donmccurdy/aframe-extras/master/dist/aframe-extras.loaders.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>

    <style>
      body {
        margin: 0;
        overflow: hidden;
      }
      
      .back-button {
        position: fixed;
        top: 20px;
        left: 20px;
        z-index: 1000;
        background: rgba(0, 0, 0, 0.7);
        color: #fff;
        padding: 10px 20px;
        border-radius: 5px;
        text-decoration: none;
        font-family: Arial, sans-serif;
        font-size: 14px;
      }
      
      .back-button:hover {
        background: rgba(0, 0, 0, 0.9);
      }

      .btns {
        position: fixed;
        bottom: 50px;
        left: 50%;
        transform: translateX(-50%);
        display: flex;
        gap: 12px;
        z-index: 999;
      }

      button {
        width: 40px;
        height: 40px;
        border-radius: 18px;
        background: rgba(255, 255, 255, 0.18);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.25);
        color: white;
        font-size: 22px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.35);
        cursor: pointer;
        transition: all 0.2s ease;
      }

      button:active {
        transform: scale(0.9);
      }

      #hud {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 999;
        background: rgba(0, 0, 0, 0.7);
        color: #fff;
        padding: 10px 20px;
        border-radius: 8px;
        font-family: Arial, sans-serif;
        font-size: 14px;
      }
    </style>

    <script>
      AFRAME.registerComponent("animation-tester", {
        init: function () {
          const marker = this.el;
          const modelEl = marker.querySelector("[animation-mixer]");
          const hud = document.getElementById("hud");

          let clips = [];
          let index = 0;
          let loaded = false;

          function updateHUD() {
            hud.innerText = `üé¨ ${clips[index] || "Carregando..."}`;
          }

          modelEl.addEventListener("model-loaded", (e) => {
            const model = e.detail.model;
            clips = model.animations.map((a) => a.name);
            loaded = true;

            console.log("üéûÔ∏è Anima√ß√µes:", clips);

            modelEl.setAttribute("animation-mixer", {
              clip: clips[index],
              loop: "once",
              timeScale: 0,
            });

            updateHUD();
          });

          marker.addEventListener("markerFound", () => {
            if (!loaded) return;
            modelEl.setAttribute("animation-mixer", "timeScale: 1");
          });

          marker.addEventListener("markerLost", () => {
            modelEl.setAttribute("animation-mixer", "timeScale: 0");
          });

          window.nextAnim = () => {
            if (!loaded) return;
            index = (index + 1) % clips.length;
            modelEl.setAttribute("animation-mixer", {
              clip: clips[index],
              loop: "once",
              timeScale: 1,
            });
            updateHUD();
          };

          window.prevAnim = () => {
            if (!loaded) return;
            index = (index - 1 + clips.length) % clips.length;
            modelEl.setAttribute("animation-mixer", {
              clip: clips[index],
              loop: "once",
              timeScale: 1,
            });
            updateHUD();
          };
        },
      });
    </script>
  </head>

  <body style="margin: 0; overflow: hidden">
    <a href="index.html" class="back-button">
      ‚Üê Voltar
    </a>

    <!-- HUD -->
    <div id="hud">üé¨ Carregando...</div>

    <!-- Bot√µes -->
    <div class="btns">
      <button onclick="prevAnim()">‚èÆ</button>
      <button onclick="nextAnim()">‚è≠</button>
    </div>

    <a-scene embedded arjs="sourceType: webcam;">
      <a-assets>
        <a-asset-item id="robot" src="models/robot.glb"></a-asset-item>
      </a-assets>

      <a-marker preset="hiro" animation-tester>
        <a-entity
          gltf-model="#robot"
          scale="1 1 1"
          position="0 0 0"
          animation-mixer
        ></a-entity>
      </a-marker>

      <a-entity camera></a-entity>
    </a-scene>
  </body>
</html>

